<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Tree view for mass invoicing & billing -->
    <record id="view_mass_account_move_tree" model="ir.ui.view">
        <field name="name">mass.account.move.tree</field>
        <field name="model">mass.account.move</field>
        <field name="arch" type="xml">
            <tree string="Mass Invoicing / Billing" decoration-info="state in ('start', 'scheduled')" decoration-success="state == 'processed'" decoration-muted="state == 'cancel'" sample="1">
                <field name="name"/>
                <field name="model_id"/>
                <field name="user_id" widget="many2one_avatar_user"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="schedule_date" string="Scheduled" widget="remaining_days"/>
                <field name="state" decoration-info="state in ('start', 'scheduled')" decoration-success="state == 'processed'" decoration-muted="state == 'cancel'" widget="badge"/>
            </tree>
        </field>
    </record>

    <!-- Form view for mass invoicing & billing -->
    <record id="view_mass_account_move_form" model="ir.ui.view">
        <field name="name">mass.account.move.form</field>
        <field name="model">mass.account.move</field>
        <field name="arch" type="xml">
            <form string="Mass Invoicing / Billing" js_class="js_mass_account_move">
                <header>
                    <button id="queue_process" attrs="{'invisible': [('state', 'in', ('scheduled', 'processed', 'cancel'))]}" class="oe_highlight" string="Queue Process"/>
                    <button name="button_process" type="object" attrs="{'invisible': [('state', 'in', ('scheduled', 'processed', 'cancel'))]}" class="btn-secondary" string="Process" confirm="Use of 'Queue Process' is recommended to dealing with large number of orders. If there is a large number of orders it can take a long time and might be possible that process will killed by server. Are you sure want to proceed anyway?"/> 
                    <!-- confirm="This will run process for all filtered orders, If there is large numbers of orders then it will take more time and possibly proce?" -->
                    <button name="button_start" type="object" attrs="{'invisible': [('state', 'in', ('start', 'scheduled'))]}" class="oe_highlight" string="Re-start"/>
                    <button name="button_cancel" type="object" attrs="{'invisible': [('state', 'in', ('start', 'cancel'))]}" class="btn-secondary" string="Cancel"/>
                    <button name="%(fenix_mass_invoicing_billing.mass_account_move_schedule_action)d" type="action" attrs="{'invisible': [('state', 'in', ('scheduled', 'processed', 'cancel'))]}" class="btn-secondary" string="Schedule"/>
                    <field name="state" readonly="1" widget="statusbar" statusbar_visible="start,scheduled,processed"/>
                </header>
                <div class="alert alert-info text-center" role="alert" attrs="{'invisible': [('state', '!=', 'scheduled')]}">
                    <div attrs="{'invisible': [('state', '!=', 'scheduled')]}">
                        <strong>
                            <span name="schedule_date_text">This process is scheduled for </span>
                            <field name="schedule_date" class="oe_inline"/>.
                        </strong>
                    </div>
                </div>
                <sheet>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                    <div class="oe_title oe_inline">
                        <label for="name" class="oe_edit_only"/>
                        <h4><field name="name" placeholder="e.g. Mass Invoicing / Billing"/></h4>
                    </div>
                    <group>
                        <field name="active" invisible="1"/>
                        <label for="model_id" string="Model"/>
                        <div name="model_container">
                            <div class="row">
                                <div class="col-xs-12 col-md-3">
                                    <field name="model_id" widget="selection"/>
                                </div>
                            </div>
                            <field name="model_name" invisible="1"/>
                            <div>
                                <field name="domain" widget="domain" options="{'model': 'model_name'}"/>
                            </div>
                        </div>
                        <field name="partner_count" invisible="1"/>
                        <field name="processed_partner_ids" widget="many2many_tags" invisible="1"/>
                    </group>
                    <group name="conditions" string="Conditions">
                       <div class="row alert alert-info" role="alert">
                            <div class="col-6">
                                <field name="partner_with_threshold" class="oe_inline"/> Generate invoices only for customer with threshold.
                            </div>
                            <div class="col-6">
                                <field name="is_grouped_move" class="oe_inline"/> Generate only one invoice per customer.
                            </div>
                            <div class="col-6">
                                <field name="is_auto_confirm" class="oe_inline"/> Automatically confirm <span attrs="{'invisible': [('model_name', '=', 'purchase.order')]}">Quotations</span> <span attrs="{'invisible': [('model_name', '=', 'sale.order')]}">RFQs and create vendor bills by <field name="confirm_by" class="oe_inline" required="1"/></span>.
                            </div>
                            <!-- <div class="col-6" attrs="{'invisible': [('model_name', '=', 'purchase.order')]}">
                                <field name="pre_check_errors" class="oe_inline"/> Do not generate invoices if customer has no email/address available.
                            </div> -->
                        </div>
                    </group>

                    <group>
                        <field name="invoice_date" class="oe_inline"/>
                    </group>
                    <group>
                        <field name="template_id" options="{'no_create': True, 'no_edit': True}" context="{'default_model': 'account.move'}" class="oe_inline"/>
                    </group>

                    <group name="confirm_sent_options" string="Confirmation &amp; Sent Options">
                        <group attrs="{'invisible': [('model_name', '=', 'purchase.order')]}">
                            <label for="move_confirmation" string="Invoice Confirmation"/>
                            <field name="move_confirmation" widget="radio" nolabel="1"/>
                        </group>
                        <group attrs="{'invisible': [('model_name', '=', 'sale.order')]}">
                            <label for="move_confirmation" string="Bill Confirmation"/>
                            <field name="move_confirmation" widget="radio" nolabel="1"/>
                        </group>
                        <group attrs="{'invisible': [('move_confirmation', 'not in', ('create_sent', 'create_confirm_sent'))]}">
                            <field name="sent_option" widget="radio"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="mass_account_move_history" string="History">
                            <group attrs="{'invisible': [('account_move_history_ids', '=', [])]}">
                                <group>
                                    <button name="generate_history" type="object" class="oe_link" icon="fa-arrow-right" string="Generate Excel File"/>
                                </group>
                                <group>
                                    <field name="filename" colspan="4" invisible="1"/>
                                    <field name="excel_file" string="Download" filename="filename" colspan="4"/>
                                </group>
                            </group>
                            <group>
                                <field name="account_move_history_ids" nolabel="1"/>
                            </group>
                        </page>
                        <page name="other" string="Other Information">
                            <group>
                                <group>
                                    <field name="user_id" options="{'no_create': True, 'no_open': True}" widget="many2one_avatar_user"/>
                                    <field name="company_id" readonly="1" groups="base.group_multi_company" required="1" options="{'no_create': True, 'no_open': True}"/>
                                </group>
                                <group>
                                    <field name="create_date"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="message_ids" />
                </div>
            </form>
        </field>
    </record>

    <!-- Search view for mass invoicing & billing -->
    <record id="view_mass_account_move_search" model="ir.ui.view">
        <field name="name">mass.account.move.search</field>
        <field name="model">mass.account.move</field>
        <field name="arch" type="xml">
            <search string="Search Mass Creation Invoice/Bills">
                <field name="name" string="Mass Invoicing / Billing" filter_domain="[('name', 'ilike', self)]"/>
                <field name="user_id"/>
                <field name="model_id"/>
                <separator/>
                <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
                <separator/>
                <filter string="Schedule Date" name="filter_schedule_date" date="schedule_date"/>
                <group expand="0" string="Group By">
                    <filter string="Responsible" name="responsible" domain="[]" context="{'group_by': 'user_id'}"/>
                    <separator/>
                    <filter string="Model" name="model_id" domain="[]" context="{'group_by': 'model_id'}"/>
                    <filter string="Invoice Confirmation" name="move_confirmation" domain="[]" context="{'group_by': 'move_confirmation'}"/>
                    <filter string="Email / Snailmail" name="sent_option" domain="[]" context="{'group_by': 'sent_option'}"/>
                    <filter string="Status" name="state" domain="[]" context="{'group_by': 'state'}"/>
                    <separator/>
                    <filter string="Company" name="company" domain="[]" context="{'group_by': 'company_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban view for mass invoicing & billing -->
    <record model="ir.ui.view" id="view_mass_account_move_kanban">
        <field name="name">mass.account.move.kanban</field>
        <field name="model">mass.account.move</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" quick_create="false" sample="1">
                <field name='state' readonly="1"/>
                <field name='user_id'/>
                <field name='color'/>
                <field name='model_id'/>
                <field name='model_name'/>
                <field name='schedule_date'/>
                <field name='active'/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click">
                            <div class="o_dropdown_kanban dropdown" t-if="!selection_mode">
                                <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" data-display="static" aria-label="Dropdown menu" title="Dropdown menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <ul class="oe_kanban_colorpicker" data-field="color"/>
                                    <t t-if="widget.deletable">
                                        <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                    </t>
                                    <a role="menuitem" class="dropdown-item" name="toggle_active" type="object">
                                        <t t-if="record.active.raw_value">Archive</t>
                                        <t t-if="!record.active.raw_value">Restore</t>
                                    </a>
                                </div>
                            </div>
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <div class="row">
                                            <h3 class="my-1 col-8 o_text_overflow">
                                                <field name="name"/>
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div name="div_responsible_avatar" class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <span attrs="{'invisible': [('schedule_date', '=', False)]}"
                                        t-attf-title="Scheduled on #{record.schedule_date.value}" class="d-inline-flex">
                                        <span class="fa fa-hourglass-half mr-2 small my-auto" aria-label="Scheduled date"/>
                                        <span class="align-self-baseline"><field name="schedule_date" widget="date"/></span>
                                    </span>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="user_id" widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action view for mass invoicing & billing -->
    <record id="action_mass_account_move" model="ir.actions.act_window">
        <field name="name">Mass Invoicing / Billing</field>
        <field name="res_model">mass.account.move</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="view_mass_account_move_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Mass Invoicing / Billing
            </p>
        </field>
    </record>

    <menuitem id="menu_mass_account_move_base" name="Mass Invoices / Bills" sequence="2" parent="account_accountant.menu_accounting" action="fenix_mass_invoicing_billing.action_mass_account_move"/>


    <!-- History views -->
    <record model="ir.ui.view" id="view_mass_account_move_history_tree">
        <field name="name">mass.account.move.history.tree</field>
        <field name="model">mass.account.move.history</field>
        <field name="arch" type="xml">
            <tree create="0" edit="0" delete="0" decoration-success="record_status == 'pass'" decoration-danger="record_status == 'fail'">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="message" optional="hide"/>
                <field name="record_status" string="Status"/>
                <field name="mass_account_move_id" invisible="1"/>
                <field name="create_date" readonly="1"/>
                <field name="create_uid" string="Responsible" readonly="1"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_mass_account_move_history_form">
        <field name="name">mass.account.move.history.form</field>
        <field name="model">mass.account.move.history</field>
        <field name="arch" type="xml">
            <form string="History">
                <group>
                    <group>
                        <field name="name"/>
                        <field name="message"/>
                    </group>
                    <group>
                        <field name="record_status"/>
                        <field name="mass_account_move_id" invisible="1"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
</odoo>
